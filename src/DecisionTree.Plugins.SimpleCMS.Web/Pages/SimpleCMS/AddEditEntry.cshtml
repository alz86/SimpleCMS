@page
@using System.Web
@using DecisionTree.Plugins.SimpleCMS.Localization
@using DecisionTree.Plugins.SimpleCMS.Pages.SimpleCMS
@using Microsoft.AspNetCore.Mvc.Localization
@using Volo.Abp.AspNetCore.Mvc.UI.Bootstrap.TagHelpers.Modal
@using Volo.Abp.AspNetCore.Mvc.UI.Packages.TuiEditor
@model DecisionTree.Plugins.SimpleCMS.Pages.SimpleCMS.AddEditEntryModel
@inject IHtmlLocalizer<SimpleCMSResource> L
@section scripts {
    @* <abp-script-bundle name="@typeof(IndexModel).FullName">
        <abp-script src="/Pages/SimpleCMS/AddEditEntry.js" />
    </abp-script-bundle>
 *@}
@{
    Layout = null;
}
<form method="post" asp-page="/SimpleCMS/AddEditEntry" id="new-entry-form">
    <abp-modal size="Large">
        <abp-modal-header title="@L["SimpleCMS:Pages:Create"].Value"></abp-modal-header>
        <abp-modal-body>
            <div class="mt-3" id="new-entry-container">
                <abp-input asp-for="ContentEntryInfo!.Id" />
                <abp-input asp-for="ContentEntryInfo!.Name" auto-focus="true" label="@L["SimpleCMS:Fields:Name"].Value" />
                <abp-input asp-for="ContentEntryInfo!.Title" label="@L["SimpleCMS:Fields:Title"].Value" />
                <abp-input asp-for="ContentEntryInfo!.Content" />
                <div class="mb-3">
                    <label class="form-label">
                        @L["SimpleCMS:Fields:Content"].Value
                    </label>
                    <div class="new-entry-editor">
                        <div class="gradient-background-animation loading-cover"></div>
                    </div>
                </div>
            </div>
        </abp-modal-body>
        <abp-modal-footer buttons="@(AbpModalButtons.Cancel|AbpModalButtons.Save)"></abp-modal-footer>
    </abp-modal>
</form>
<script>
    $(function () {
        var $container = $('#new-entry-container');
        var $form = $('#new-entry-form');
        var $editorContainer = $container.find('.new-entry-editor');
        var $submitButton = $form.find('button[type=submit]');
        var $postTextInput = $form.find("input[name='ContentEntryInfo.Content']");

        var newPostEditor = new toastui.Editor({
            el: $editorContainer[0],
            usageStatistics: false,
            initialEditType: 'wysiwyg',
            height: 'auto',
            initialValue: $postTextInput.val(),
            hideModeSwitch: true,
        });

        $form.submit(function (e) {

            var postText = newPostEditor.getHTML();
            $postTextInput.val(postText);

            if (!$form.valid()) {
                var validationResult = $form.validate();
                abp.message.warn(validationResult.errorList[0].message);
                e.preventDefault();
                return false; //for old browsers
            }

            $submitButton.buttonBusy();
            $(this).off('submit').submit();

            return true;

        });
    });

</script>